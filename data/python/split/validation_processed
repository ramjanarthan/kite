நஅஅஅஅdefஅ_ending_tester(self,அvalue,அvalue_type,அexpected):நஅஅஅஅஅஅஅஅresultஅ=அget_value_range(value,அvalue_type)நஅஅஅஅஅஅஅஅself.assertEqual(result,அexpected)நநஅஅஅஅdefஅtest_int_str_scalar(self):நஅஅஅஅஅஅஅஅself._ending_tester('',அint,அValueRange(,அ,அ0))நநஅஅஅஅdefஅtest_int_str_scalar_radius(self):நஅஅஅஅஅஅஅஅself._ending_tester('~',அint,அValueRange(,அ,அ))நநஅஅஅஅdefஅtest_int_str_range(self):நஅஅஅஅஅஅஅஅself._ending_tester(':',அint,அValueRange(,அ,அ0))நநஅஅஅஅdefஅtest_int_str_range_radius(self):நஅஅஅஅஅஅஅஅself._ending_tester(':~',அint,அValueRange(,அ,அ))நநஅஅஅஅdefஅtest_int_scalar(self):நஅஅஅஅஅஅஅஅself._ending_tester(,அint,அValueRange(,அ,அ0))நநஅஅஅஅdefஅtest_int_tuple(self):நஅஅஅஅஅஅஅஅself._ending_tester((,அ),அint,அValueRange(,அ,அ0))நநஅஅஅஅdefஅtest_int_tuple(self):நஅஅஅஅஅஅஅஅself._ending_tester((,அ,அ),அint,அValueRange(,அ,அ))நநஅஅஅஅdefஅtest_float_str_scalar(self):நஅஅஅஅஅஅஅஅself._ending_tester('.0',அfloat,அValueRange(.0,அ.0,அ0.0))நநஅஅஅஅdefஅtest_float_str_scalar_radius(self):நஅஅஅஅஅஅஅஅself._ending_tester('.0~.0',அfloat,அValueRange(.0,அ.0,அ.0))நநஅஅஅஅdefஅtest_float_str_range(self):நஅஅஅஅஅஅஅஅself._ending_tester('.0:.0',அfloat,அValueRange(.0,அ.0,அ0.0))நநஅஅஅஅdefஅtest_float_str_range_radius(self):நஅஅஅஅஅஅஅஅself._ending_tester('.0:.0~.0',அfloat,அValueRange(.0,அ.0,அ.0))நநஅஅஅஅdefஅtest_float_scalar(self):நஅஅஅஅஅஅஅஅself._ending_tester(.0,அfloat,அValueRange(.0,அ.0,அ0.0))நநஅஅஅஅdefஅtest_float_tuple(self):நஅஅஅஅஅஅஅஅself._ending_tester((.0,அ.0),அfloat,அValueRange(.0,அ.0,அ0.0))நநஅஅஅஅdefஅtest_float_tuple(self):நஅஅஅஅஅஅஅஅself._ending_tester((.0,அ.0,அ.0),அfloat,அValueRange(.0,அ.0,அ.0))நநஅஅஅஅdefஅtest_float_int_tuple(self):நஅஅஅஅஅஅஅஅself._ending_tester((,அ,அ),அfloat,அValueRange(.0,அ.0,அ.0))நநநclassஅTestPickValueFromFixedRange(unittest.TestCase):நஅஅஅஅdefஅ__init__(self,அ*args,அ**kwargs):நஅஅஅஅஅஅஅஅsuper(TestPickValueFromFixedRange,அself).__init__(*args,அ**kwargs)நஅஅஅஅஅஅஅஅself.sessionஅ=அtf.Session()நஅஅஅஅஅஅஅஅself.clock_phஅ=அtf.placeholder(dtype=tf.float,அname='clock')நநஅஅஅஅdefஅ_ending_tester(self,அvalue_range,அclock,அexpected):நஅஅஅஅஅஅஅஅwithஅtf.Session()அasஅsession:நஅஅஅஅஅஅஅஅஅஅஅஅtf_pickஅ=அtf_pick_value_from_range(value_range,அclock=self.clock_ph)நநஅஅஅஅஅஅஅஅஅஅஅஅdefஅrun_pick(_,அc):நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅreturnஅsession.run(tf_pick,அfeed_dict={self.clock_ph:அc})நநஅஅஅஅஅஅஅஅஅஅஅஅis_intஅ=அisinstance(value_range.start,அint)நஅஅஅஅஅஅஅஅஅஅஅஅforஅpick,அint_type,அfloat_typeஅinஅ[(pick_value_from_range,அint,அfloat),அ(run_pick,அnp.int,அnp.float)]:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅresultஅ=அpick(value_range,அclock)நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅself.assertEqual(result,அexpected)நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅself.assertTrue(isinstance(result,அint_typeஅifஅis_intஅelseஅfloat_type))நநஅஅஅஅdefஅtest_int_0(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(,அ,அ0),அ0.0,அ)நநஅஅஅஅdefஅtest_int_half(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(,அ,அ0),அ0.,அ)நநஅஅஅஅdefஅtest_int_(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(,அ,அ0),அ.0,அ)நநஅஅஅஅdefஅtest_float_0(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(.0,அ.0,அ0.0),அ0.0,அ.0)நநஅஅஅஅdefஅtest_float_half(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(.0,அ.0,அ0.0),அ0.,அ.)நநஅஅஅஅdefஅtest_float_(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(.0,அ.0,அ0.0),அ.0,அ.0)நநநclassஅTestPickValueFromRandomizedRange(unittest.TestCase):நஅஅஅஅdefஅ__init__(self,அ*args,அ**kwargs):நஅஅஅஅஅஅஅஅsuper(TestPickValueFromRandomizedRange,அself).__init__(*args,அ**kwargs)நஅஅஅஅஅஅஅஅself.sessionஅ=அtf.Session()நஅஅஅஅஅஅஅஅself.clock_phஅ=அtf.placeholder(dtype=tf.float,அname='clock')நநஅஅஅஅdefஅ_ending_tester(self,அvalue_range,அclock_min,அclock_max,அexpected_min,அexpected_max):நஅஅஅஅஅஅஅஅwithஅself.sessionஅasஅsession:நஅஅஅஅஅஅஅஅஅஅஅஅtf_pickஅ=அtf_pick_value_from_range(value_range,அclock=self.clock_ph)நநஅஅஅஅஅஅஅஅஅஅஅஅdefஅrun_pick(_,அc):நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅreturnஅsession.run(tf_pick,அfeed_dict={self.clock_ph:அc})நநஅஅஅஅஅஅஅஅஅஅஅஅis_intஅ=அisinstance(value_range.start,அint)நஅஅஅஅஅஅஅஅஅஅஅஅclock_rangeஅ=அnp.arange(clock_min,அclock_max,அ(clock_maxஅ-அclock_min)அ/அ00.0)நஅஅஅஅஅஅஅஅஅஅஅஅforஅpick,அint_type,அfloat_typeஅinஅ[(pick_value_from_range,அint,அfloat),அ(run_pick,அnp.int,அnp.float)]:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅresultsஅ=அ[pick(value_range,அc)அforஅcஅinஅclock_range]நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅself.assertGreater(len(set(results)),அ0)நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅself.assertTrue(all(map(lambdaஅx:அexpected_minஅ<=அxஅ<=அexpected_max,அresults)))நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅself.assertTrue(all(map(lambdaஅx:அisinstance(x,அint_typeஅifஅis_intஅelseஅfloat_type),அresults)))நநஅஅஅஅdefஅtest_int_0(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(0000,அ0000,அ0000),அ0.0,அ0.,அ0,அ000)நநஅஅஅஅdefஅtest_int_half(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(0000,அ0000,அ0000),அ0.,அ0.,அ000,அ000)நநஅஅஅஅdefஅtest_int_(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(0000,அ0000,அ0000),அ0.,அ.0,அ000,அ0000)நநஅஅஅஅdefஅtest_float_0(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(0000.0,அ0000.0,அ0000.0),அ0.0,அ0.,அ0.0,அ000.0)நநஅஅஅஅdefஅtest_float_half(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(0000.0,அ0000.0,அ0000.0),அ0.,அ0.,அ000.0,அ000.0)நநஅஅஅஅdefஅtest_float_(self):நஅஅஅஅஅஅஅஅself._ending_tester(ValueRange(0000.0,அ0000.0,அ0000.0),அ0.,அ.0,அ000.0,அ0000.0)நநநifஅ__name__அ==அ'__main__':நஅஅஅஅunittest.main()ந#!/usr/bin/envஅpythonந#அ-*-அcoding:அutf-அ-*-நfromஅ__future__அimportஅabsolute_import,அprint_functionநநimportஅabsl.appநimportஅoptunaநimportஅsysநimportஅtensorflow.compat.vஅasஅtfvநநfromஅdeepspeech_training.evaluateஅimportஅevaluateநfromஅdeepspeech_training.trainஅimportஅcreate_modelநfromஅdeepspeech_training.util.configஅimportஅConfig,அinitialize_globalsநfromஅdeepspeech_training.util.flagsஅimportஅcreate_flags,அFLAGSநfromஅdeepspeech_training.util.loggingஅimportஅlog_errorநfromஅdeepspeech_training.util.evaluate_toolsஅimportஅwer_cer_batchநfromஅds_ctcdecoderஅimportஅScorerநநநdefஅcharacter_based():நஅஅஅஅis_character_basedஅ=அFalseநஅஅஅஅifஅFLAGS.scorer_path:நஅஅஅஅஅஅஅஅscorerஅ=அScorer(FLAGS.lm_alpha,அFLAGS.lm_beta,அFLAGS.scorer_path,அConfig.alphabet)நஅஅஅஅஅஅஅஅis_character_basedஅ=அscorer.is_utf_mode()நஅஅஅஅreturnஅis_character_basedநநdefஅobjective(trial):நஅஅஅஅFLAGS.lm_alphaஅ=அtrial.suggest_uniform('lm_alpha',அ0,அFLAGS.lm_alpha_max)நஅஅஅஅFLAGS.lm_betaஅ=அtrial.suggest_uniform('lm_beta',அ0,அFLAGS.lm_beta_max)நநஅஅஅஅis_character_basedஅ=அtrial.study.user_attrs['is_character_based']நநஅஅஅஅsamplesஅ=அ[]நஅஅஅஅforஅstep,அtest_fileஅinஅenumerate(FLAGS.test_files.split(',')):நஅஅஅஅஅஅஅஅtfv.reset_default_graph()நநஅஅஅஅஅஅஅஅcurrent_samplesஅ=அevaluate([test_file],அcreate_model)நஅஅஅஅஅஅஅஅsamplesஅ+=அcurrent_samplesநநஅஅஅஅஅஅஅஅ#அReportஅintermediateஅobjectiveஅvalue.நஅஅஅஅஅஅஅஅwer,அcerஅ=அwer_cer_batch(current_samples)நஅஅஅஅஅஅஅஅtrial.report(cerஅifஅis_character_basedஅelseஅwer,அstep)நநஅஅஅஅஅஅஅஅ#அHandleஅpruningஅbasedஅonஅtheஅintermediateஅvalue.நஅஅஅஅஅஅஅஅifஅtrial.should_prune():நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅoptuna.exceptions.TrialPruned()நநஅஅஅஅwer,அcerஅ=அwer_cer_batch(samples)நஅஅஅஅreturnஅcerஅifஅis_character_basedஅelseஅwerநநdefஅmain(_):நஅஅஅஅinitialize_globals()நநஅஅஅஅifஅnotஅFLAGS.test_files:நஅஅஅஅஅஅஅஅlog_error('Youஅneedஅtoஅspecifyஅwhatஅfilesஅtoஅuseஅforஅevaluationஅviaஅ'நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ'theஅ--test_filesஅflag.')நஅஅஅஅஅஅஅஅsys.exit()நநஅஅஅஅis_character_basedஅ=அcharacter_based()நநஅஅஅஅstudyஅ=அoptuna.create_study()நஅஅஅஅstudy.set_user_attr("is_character_based",அis_character_based)நஅஅஅஅstudy.optimize(objective,அn_jobs=,அn_trials=FLAGS.n_trials)நஅஅஅஅprint('Bestஅparams:அlm_alpha={}அandஅlm_beta={}அwithஅWER={}'.format(study.best_params['lm_alpha'],நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅstudy.best_params['lm_beta'],நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅstudy.best_value))நநநifஅ__name__அ==அ'__main__':நஅஅஅஅcreate_flags()நஅஅஅஅabsl.app.run(main)ந#!/usr/bin/envஅpythonந#அ-*-அcoding:அutf-அ-*-நfromஅ__future__அimportஅabsolute_import,அdivision,அprint_functionநநifஅ__name__அ==அ'__main__':நஅஅஅஅtry:நஅஅஅஅஅஅஅஅfromஅdeepspeech_trainingஅimportஅtrainஅasஅds_trainநஅஅஅஅexceptஅImportError:நஅஅஅஅஅஅஅஅprint('Trainingஅpackageஅisஅnotஅinstalled.அSeeஅtrainingஅdocumentation.')நஅஅஅஅஅஅஅஅraiseநநஅஅஅஅds_train.run_script()ந#அ-*-அcoding:அutf-அ-*-நநfromஅ__future__அimportஅabsolute_import,அprint_function,அunicode_literalsநநfromஅglobஅimportஅglobநfromஅfunctoolsஅimportஅreduceநநimportஅjsonநimportஅjsoneநimportஅosநimportஅsysநimportஅrequestsநimportஅslugidநimportஅyamlநimportஅsubprocessநநimportஅnetworkxஅasஅnxநநTASKS_ROOTஅ=அos.path.join(os.path.dirname(os.path.abspath(sys.argv[0])))நTASKCLUSTER_API_BASEURLஅ=அ'http://taskcluster/queue/v/task/%(task_id)s'நநdefஅstring_to_dict(sid,அvalue):நஅஅஅஅpartsஅ=அsid.split('.')நநஅஅஅஅdefஅpack(parts):நஅஅஅஅஅஅஅஅifஅlen(parts)அ==அ:நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅ{parts[0]:அvalue}நஅஅஅஅஅஅஅஅelifஅlen(parts):நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅ{parts[0]:அpack(parts[:])}நஅஅஅஅஅஅஅஅreturnஅpartsநநஅஅஅஅreturnஅpack(parts)நநdefஅmerge_dicts(*dicts):நஅஅஅஅifஅnotஅreduce(lambdaஅx,அy:அisinstance(y,அdict)அandஅx,அdicts,அTrue):நஅஅஅஅஅஅஅஅraiseஅTypeError("Objectஅinஅ*dictsஅnotஅofஅtypeஅdict")நஅஅஅஅifஅlen(dicts)அ<அ:நஅஅஅஅஅஅஅஅraiseஅValueError("Requiresஅஅorஅmoreஅdictஅobjects")நநஅஅஅஅdefஅmerge(a,அb):நஅஅஅஅஅஅஅஅforஅdஅinஅset(a.keys()).union(b.keys()):நஅஅஅஅஅஅஅஅஅஅஅஅifஅdஅinஅaஅandஅdஅinஅb:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅifஅtype(a[d])அ==அtype(b[d]):நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅifஅnotஅisinstance(a[d],அdict):நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅretஅ=அlist({a[d],அb[d]})நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅifஅlen(ret)அ==அ:அretஅ=அret[0]நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅyieldஅ(d,அsorted(ret))நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅelse:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅyieldஅ(d,அdict(merge(a[d],அb[d])))நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅelse:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅraiseஅTypeError("Conflictingஅkey:valueஅtypeஅassignment",அtype(a[d]),அa[d],அtype(b[d]),அb[d])நஅஅஅஅஅஅஅஅஅஅஅஅelifஅdஅinஅa:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅyieldஅ(d,அa[d])நஅஅஅஅஅஅஅஅஅஅஅஅelifஅdஅinஅb:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅyieldஅ(d,அb[d])நஅஅஅஅஅஅஅஅஅஅஅஅelse:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅraiseஅKeyErrorநநஅஅஅஅreturnஅreduce(lambdaஅx,அy:அdict(merge(x,அy)),அdicts[:],அdicts[0])நநdefஅtaskcluster_event_context():நஅஅஅஅdas_contextஅ=அ{}நநஅஅஅஅ#அPre-filtertingநஅஅஅஅforஅkஅinஅos.environ.keys():நஅஅஅஅஅஅஅஅifஅkஅ==அ'GITHUB_HEAD_USER':நஅஅஅஅஅஅஅஅஅஅஅஅos.environ['GITHUB_HEAD_USER_LOGIN']அ=அos.environ[k]நஅஅஅஅஅஅஅஅஅஅஅஅdelஅos.environ['GITHUB_HEAD_USER']நநஅஅஅஅforஅkஅinஅos.environ.keys():நஅஅஅஅஅஅஅஅifஅkஅ==அ'TASK_ID':நஅஅஅஅஅஅஅஅஅஅஅஅpartsஅ=அstring_to_dict('taskcluster.taskGroupId',அos.environ[k])நஅஅஅஅஅஅஅஅஅஅஅஅdas_contextஅ=அmerge_dicts(das_context,அparts)நநஅஅஅஅஅஅஅஅifஅk.startswith('GITHUB_'):நஅஅஅஅஅஅஅஅஅஅஅஅpartsஅ=அstring_to_dict(k.lower().replace('_',அ'.').replace('github',அ'event'),அos.environ[k])நஅஅஅஅஅஅஅஅஅஅஅஅdas_contextஅ=அmerge_dicts(das_context,அparts)நநஅஅஅஅreturnஅdas_contextநநdefஅload_specific_contextFile(file):நஅஅஅஅspecific_contextஅ=அ{}நநஅஅஅஅtry:நஅஅஅஅஅஅஅஅwithஅopen(os.path.join(TASKS_ROOT,அfile))அasஅsrc:நஅஅஅஅஅஅஅஅஅஅஅஅspecific_contextஅ=அyaml.safe_load(src)நநஅஅஅஅஅஅஅஅifஅspecific_contextஅisஅNone:நஅஅஅஅஅஅஅஅஅஅஅஅspecific_contextஅ=அ{}நஅஅஅஅexceptஅFileNotFoundError:நஅஅஅஅஅஅஅஅspecific_contextஅ=அ{}நநஅஅஅஅreturnஅspecific_contextநநdefஅdefaultValues_build_context():நஅஅஅஅreturnஅload_specific_contextFile('.build.yml')நநdefஅshared_context():நஅஅஅஅreturnஅload_specific_contextFile('.shared.yml')நநdefஅcreate_task_payload(build,அbase_context):நஅஅஅஅprint('build',அbuild)நஅஅஅஅbuild_typeஅ=அos.path.splitext(os.path.basename(build))[0]நநஅஅஅஅbuild_contextஅ=அdefaultValues_build_context()நஅஅஅஅwithஅopen(build)அasஅsrc:நஅஅஅஅஅஅஅஅbuild_context['build'].update(yaml.safe_load(src)['build'])நநஅஅஅஅ#அBeஅableஅtoஅuseஅwhatஅhasஅbeenஅdefinedஅinஅbase_contextநஅஅஅஅ#அe.g.,அtheஅ{${event.head.branch}}நஅஅஅஅbuild_contextஅ=அjsone.render(build_context,அbase_context)நஅஅஅஅtemplate_contextஅ=அ{நஅஅஅஅஅஅஅஅ'taskcluster':அ{நஅஅஅஅஅஅஅஅஅஅஅஅ'taskId':அas_slugid(build_type)நஅஅஅஅஅஅஅஅ},நஅஅஅஅஅஅஅஅ'build_type':அbuild_typeநஅஅஅஅ}நநஅஅஅஅwithஅopen(os.path.join(TASKS_ROOT,அbuild_context['build']['template_file']))அasஅsrc:நஅஅஅஅஅஅஅஅtemplateஅ=அyaml.safe_load(src)நநஅஅஅஅcontextesஅ=அmerge_dicts({},அbase_context,அtemplate_context,அbuild_context)நஅஅஅஅforஅone_contextஅinஅglob(os.path.join(TASKS_ROOT,அ'*.cyml')):நஅஅஅஅஅஅஅஅwithஅopen(one_context)அasஅsrc:நஅஅஅஅஅஅஅஅஅஅஅஅcontextesஅ=அmerge_dicts(contextes,அyaml.safe_load(src))நநஅஅஅஅreturnஅjsone.render(template,அcontextes)நநdefஅsend_task(t):நஅஅஅஅurlஅ=அTASKCLUSTER_API_BASEURLஅ%அ{'task_id':அt['taskId']}நஅஅஅஅdelஅt['taskId']நநஅஅஅஅrஅ=அrequests.put(url,அjson=t)நநஅஅஅஅprint(url,அr.status_code)நஅஅஅஅifஅr.status_codeஅ!=அrequests.codes.ok:நஅஅஅஅஅஅஅஅprint(json.dumps(t,அindent=))நஅஅஅஅஅஅஅஅprint(r.content)நஅஅஅஅஅஅஅஅprint(json.loads(r.content.decode())['message'])நநஅஅஅஅreturnஅr.status_codeஅ==அrequests.codes.okநநslugidsஅ=அ{}நdefஅas_slugid(name):நஅஅஅஅifஅnameஅnotஅinஅslugids:நஅஅஅஅஅஅஅஅslugids[name]அ=அslugid.nice().decode()நஅஅஅஅஅஅஅஅprint('cacheஅmiss',அname,அslugids[name])நஅஅஅஅelse:நஅஅஅஅஅஅஅஅprint('cacheஅhit',அname,அslugids[name])நஅஅஅஅreturnஅslugids[name]நநdefஅto_int(x):நஅஅஅஅreturnஅint(x)நநdefஅfunctions_context():நஅஅஅஅreturnஅ{நஅஅஅஅஅஅஅஅ'as_slugid':அas_slugid,நஅஅஅஅஅஅஅஅ'to_int':அto_intநஅஅஅஅ}நநdefஅis_dry_run():நஅஅஅஅreturnஅ(len(sys.argv)அ>அ)அandஅ(sys.argv[]அ==அ'--dry')நநdefஅshould_run():நஅஅஅஅ#அMakeஅaஅquickஅcloneஅtoஅfetchஅtheஅlastஅcommitநஅஅஅஅtry:நஅஅஅஅஅஅஅஅsubprocess.check_call([நஅஅஅஅஅஅஅஅஅஅஅஅ'git',அ'clone',அ'--quiet',அ'-b',அos.environ.get('GITHUB_HEAD_BRANCH'),நஅஅஅஅஅஅஅஅஅஅஅஅ'--single-branch',அos.environ.get('GITHUB_HEAD_REPO_URL'),நஅஅஅஅஅஅஅஅஅஅஅஅ'--depth=',அ'/tmp/ds-clone/'நஅஅஅஅஅஅஅஅ],அenv={'GIT_LFS_SKIP_SMUDGE':அ''})நஅஅஅஅexceptஅsubprocess.CalledProcessErrorஅasஅe:நஅஅஅஅஅஅஅஅprint("Errorஅwhileஅgitஅcloning:",அe,அfile=sys.stderr)நஅஅஅஅஅஅஅஅreturnஅFalseநநஅஅஅஅtry:நஅஅஅஅஅஅஅஅgit_msgஅ=அsubprocess.check_output([நஅஅஅஅஅஅஅஅஅஅஅஅ'git',அ'--git-dir=/tmp/ds-clone/.git/',நஅஅஅஅஅஅஅஅஅஅஅஅ'log',அ'--format=%b',அ'-n',அ'',நஅஅஅஅஅஅஅஅஅஅஅஅos.environ.get('GITHUB_HEAD_SHA')நஅஅஅஅஅஅஅஅ]).decode('utf-').strip().upper()நஅஅஅஅexceptஅsubprocess.CalledProcessErrorஅasஅe:நஅஅஅஅஅஅஅஅprint("Errorஅwhileஅgitஅshow:",அe,அfile=sys.stderr)நஅஅஅஅஅஅஅஅreturnஅFalseநநஅஅஅஅprint('Commitஅmessage:',அgit_msg)நநஅஅஅஅx_deepspeechஅ=அfilter(lambdaஅx:அ'X-DEEPSPEECH:'அinஅx,அgit_msg.split('\n'))நஅஅஅஅifஅlen(list(filter(lambdaஅx:அ'NOBUILD'அinஅx,அx_deepspeech)))அ==அ:நஅஅஅஅஅஅஅஅprint('Notஅrunningஅanythingஅaccordingஅtoஅcommitஅmessage')நஅஅஅஅஅஅஅஅreturnஅFalseநநஅஅஅஅreturnஅTrueநநifஅ__name__அ==அ'__main__':நஅஅஅஅifஅnotஅis_dry_run():நஅஅஅஅஅஅஅஅ#அWeஅmightஅwantஅtoஅNOTஅrunஅinஅsomeஅcasesநஅஅஅஅஅஅஅஅifஅnotஅshould_run():நஅஅஅஅஅஅஅஅஅஅஅஅsys.exit(0)நநஅஅஅஅbase_contextஅ=அtaskcluster_event_context()நஅஅஅஅbase_contextஅ=அmerge_dicts(base_context,அfunctions_context())நஅஅஅஅbase_contextஅ=அmerge_dicts(base_context,அshared_context())நநஅஅஅஅroot_taskஅ=அbase_context['taskcluster']['taskGroupId']நநஅஅஅஅtasks_graphஅ=அnx.DiGraph()நஅஅஅஅtasksஅ=அ{}நநஅஅஅஅforஅbuildஅinஅglob(os.path.join(TASKS_ROOT,அ'*.yml')):நஅஅஅஅஅஅஅஅtஅ=அcreate_task_payload(build,அbase_context)நநஅஅஅஅஅஅஅஅ#அWeஅallowஅtemplateஅtoஅproduceஅcompletelyஅemptyஅoutputநஅஅஅஅஅஅஅஅifஅnotஅt:நஅஅஅஅஅஅஅஅஅஅஅஅcontinueநநஅஅஅஅஅஅஅஅifஅ'dependencies'அinஅtஅandஅlen(t['dependencies'])அ>அ0:நஅஅஅஅஅஅஅஅஅஅஅஅforஅdepஅinஅt['dependencies']:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅtasks_graph.add_edge(t['taskId'],அdep)நஅஅஅஅஅஅஅஅelse:நஅஅஅஅஅஅஅஅஅஅஅஅtasks_graph.add_edge(t['taskId'],அroot_task)நநஅஅஅஅஅஅஅஅtasks[t['taskId']]அ=அtநநஅஅஅஅforஅtaskஅinஅnx.dfs_postorder_nodes(tasks_graph):நஅஅஅஅஅஅஅஅ#அroot_taskஅisஅtheஅtaskஅgroupஅandஅalsoஅtheஅtaskஅidஅthatஅisஅalreadyநஅஅஅஅஅஅஅஅ#அrunning,அsoஅweஅdon'tஅhaveஅtoஅscheduleஅthatநஅஅஅஅஅஅஅஅifஅtaskஅ==அroot_task:நஅஅஅஅஅஅஅஅஅஅஅஅcontinueநநஅஅஅஅஅஅஅஅtஅ=அtasks[task]நஅஅஅஅஅஅஅஅifஅis_dry_run():நஅஅஅஅஅஅஅஅஅஅஅஅprint(json.dumps(t,அindent=))நஅஅஅஅஅஅஅஅஅஅஅஅcontinueநநஅஅஅஅஅஅஅஅpஅ=அsend_task(t)நஅஅஅஅஅஅஅஅifஅnotஅp:நஅஅஅஅஅஅஅஅஅஅஅஅsys.exit()நimportஅosநimportஅplatformநimportஅsysநfromஅpathlibஅimportஅPathநநfromஅpkg_resourcesஅimportஅparse_versionநfromஅsetuptoolsஅimportஅfind_packages,அsetupநநநdefஅmain():நஅஅஅஅversion_fileஅ=அPath(__file__).parentஅ/அ'VERSION'நஅஅஅஅwithஅopen(str(version_file))அasஅfin:நஅஅஅஅஅஅஅஅversionஅ=அfin.read().strip()நநஅஅஅஅinstall_requires_baseஅ=அ[நஅஅஅஅஅஅஅஅ'absl-py',நஅஅஅஅஅஅஅஅ'attrdict',நஅஅஅஅஅஅஅஅ'bs',நஅஅஅஅஅஅஅஅ'numpy',நஅஅஅஅஅஅஅஅ'optuna',நஅஅஅஅஅஅஅஅ'opuslibஅ==அ.0.0',நஅஅஅஅஅஅஅஅ'pandas',நஅஅஅஅஅஅஅஅ'progressbar',நஅஅஅஅஅஅஅஅ'pyoggஅ>=அ0..a',நஅஅஅஅஅஅஅஅ'pyxdg',நஅஅஅஅஅஅஅஅ'resampyஅ>=அ0..',நஅஅஅஅஅஅஅஅ'requests',நஅஅஅஅஅஅஅஅ'semver',நஅஅஅஅஅஅஅஅ'six',நஅஅஅஅஅஅஅஅ'sox',நஅஅஅஅஅஅஅஅ'soundfile',நஅஅஅஅ]நநஅஅஅஅdecoder_pypi_depஅ=அ[நஅஅஅஅஅஅஅஅ'ds_ctcdecoderஅ==அ{}'.format(version)நஅஅஅஅ]நநஅஅஅஅtensorflow_pypi_depஅ=அ[நஅஅஅஅஅஅஅஅ'tensorflowஅ==அ..'நஅஅஅஅ]நநஅஅஅஅhorovod_pypi_depஅ=அ[நஅஅஅஅஅஅஅஅ'horovod[tensorflow]அ==அ0..'நஅஅஅஅ]நநஅஅஅஅ#அTODO:அFIXME:அThisஅisஅlikelyஅnotஅneededஅanymoreஅgivenஅtheஅwayஅTCஅandநஅஅஅஅ#அGitHubஅActionsஅartifactsஅdiffersஅinஅhowஅweஅcanஅdownloadஅthem.நஅஅஅஅ"""நஅஅஅஅ#அDueஅtoஅpipஅcrazinessஅenvironmentஅvariablesஅareஅtheஅonlyஅconsistentஅwayஅtoநஅஅஅஅ#அgetஅoptionsஅintoஅthisஅscriptஅwhenஅdoingஅ`pipஅinstall`.நஅஅஅஅci_decoder_artifacts_rootஅ=அos.environ.get('DECODER_ARTIFACTS_ROOT',அ'')நஅஅஅஅifஅci_decoder_artifacts_root:நஅஅஅஅஅஅஅஅ#அWe'reஅrunningஅinsideஅtheஅCIஅenvironment,அoverrideஅtheஅdecoderநஅஅஅஅஅஅஅஅ#அpackageஅURLஅwithஅtheஅoneஅweஅjustஅbuilt.நஅஅஅஅஅஅஅஅdecoder_pkg_urlஅ=அget_ci_decoder_pkg_url(version,அci_decoder_artifacts_root)நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requires_baseஅ+அ[decoder_pkg_url]நஅஅஅஅ"""நஅஅஅஅifஅos.environ.get('DS_NODECODER',அ''):நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requires_baseநஅஅஅஅelse:நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requires_baseஅ+அdecoder_pypi_depநநஅஅஅஅifஅos.environ.get('DS_NOTENSORFLOW',அ''):நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requiresநஅஅஅஅelse:நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requiresஅ+அtensorflow_pypi_depநநஅஅஅஅifஅos.environ.get('DS_WITH_HOROVOD',அ''):நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requiresஅ+அhorovod_pypi_depநஅஅஅஅelse:நஅஅஅஅஅஅஅஅinstall_requiresஅ=அinstall_requiresநநநஅஅஅஅsetup(நஅஅஅஅஅஅஅஅname='deepspeech_training',நஅஅஅஅஅஅஅஅversion=version,நஅஅஅஅஅஅஅஅdescription='TrainingஅcodeஅforஅDeepSpeech',நஅஅஅஅஅஅஅஅurl='https://github.com/mozilla/DeepSpeech',நஅஅஅஅஅஅஅஅauthor='DeepSpeechஅauthors',நஅஅஅஅஅஅஅஅlicense='MPL-.0',நஅஅஅஅஅஅஅஅ#அClassifiersஅhelpஅusersஅfindஅyourஅprojectஅbyஅcategorizingஅit.நஅஅஅஅஅஅஅஅ#நஅஅஅஅஅஅஅஅ#அForஅaஅlistஅofஅvalidஅclassifiers,அseeஅhttps://pypi.org/classifiers/நஅஅஅஅஅஅஅஅclassifiers=[நஅஅஅஅஅஅஅஅஅஅஅஅ'DevelopmentஅStatusஅ::அஅ-அAlpha',நஅஅஅஅஅஅஅஅஅஅஅஅ'IntendedஅAudienceஅ::அDevelopers',நஅஅஅஅஅஅஅஅஅஅஅஅ'Topicஅ::அMultimediaஅ::அSound/Audioஅ::அSpeech',நஅஅஅஅஅஅஅஅஅஅஅஅ'Licenseஅ::அOSIஅApprovedஅ::அMozillaஅPublicஅLicenseஅ.0அ(MPLஅ.0)',நஅஅஅஅஅஅஅஅஅஅஅஅ'ProgrammingஅLanguageஅ::அPythonஅ::அ',நஅஅஅஅஅஅஅஅ],நஅஅஅஅஅஅஅஅpackage_dir={'':அ'training'},நஅஅஅஅஅஅஅஅpackages=find_packages(where='training'),நஅஅஅஅஅஅஅஅpython_requires='>=.,அ<',நஅஅஅஅஅஅஅஅinstall_requires=install_requires,நஅஅஅஅஅஅஅஅ#அIfஅthereஅareஅdataஅfilesஅincludedஅinஅyourஅpackagesஅthatஅneedஅtoஅbeநஅஅஅஅஅஅஅஅ#அinstalled,அspecifyஅthemஅhere.நஅஅஅஅஅஅஅஅpackage_data={நஅஅஅஅஅஅஅஅஅஅஅஅ'deepspeech_training':அ[நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ'VERSION',நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ'GRAPH_VERSION',நஅஅஅஅஅஅஅஅஅஅஅஅ],நஅஅஅஅஅஅஅஅ},நஅஅஅஅ)நநifஅ__name__அ==அ'__main__':நஅஅஅஅmain()ந#!/usr/bin/envஅpythonநimportஅargparseநimportஅfunctoolsநimportஅpandasநநfromஅdeepspeech_training.util.helpersஅimportஅsecs_to_hoursநfromஅpathlibஅimportஅPathநநநdefஅread_csvs(csv_files):நஅஅஅஅ#அRelativeஅpathsஅareஅrelativeஅtoஅCSVஅlocationநஅஅஅஅdefஅabsolutify(csv,அpath):நஅஅஅஅஅஅஅஅpathஅ=அPath(path)நஅஅஅஅஅஅஅஅifஅpath.is_absolute():நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅstr(path)நஅஅஅஅஅஅஅஅreturnஅstr(csv.parentஅ/அpath)நநஅஅஅஅsetsஅ=அ[]நஅஅஅஅforஅcsvஅinஅcsv_files:நஅஅஅஅஅஅஅஅfileஅ=அpandas.read_csv(csv,அencoding='utf-',அna_filter=False)நஅஅஅஅஅஅஅஅfile['wav_filename']அ=அfile['wav_filename'].apply(functools.partial(absolutify,அcsv))நஅஅஅஅஅஅஅஅsets.append(file)நநஅஅஅஅ#அConcatஅallஅsets,அdropஅanyஅextraஅcolumns,அre-indexஅtheஅfinalஅresultஅasஅ0..Nநஅஅஅஅreturnஅpandas.concat(sets,அjoin='inner',அignore_index=True)நநநdefஅmain():நஅஅஅஅparserஅ=அargparse.ArgumentParser()நநஅஅஅஅparser.add_argument("-csv",அ"--csv-files",அhelp="Str.அFilenamesஅasஅaஅcommaஅseparatedஅlist",அrequired=True)நஅஅஅஅparser.add_argument("--sample-rate",அtype=int,அdefault=000,அrequired=False,அhelp="Audioஅsampleஅrate")நஅஅஅஅparser.add_argument("--channels",அtype=int,அdefault=,அrequired=False,அhelp="Audioஅchannels")நஅஅஅஅparser.add_argument("--bits-per-sample",அtype=int,அdefault=,அrequired=False,அhelp="Audioஅbitsஅperஅsample")நஅஅஅஅargsஅ=அparser.parse_args()நஅஅஅஅin_filesஅ=அ[Path(i).absolute()அforஅiஅinஅargs.csv_files.split(",")]நநஅஅஅஅcsv_dataframeஅ=அread_csvs(in_files)நஅஅஅஅtotal_bytesஅ=அcsv_dataframe['wav_filesize'].sum()நஅஅஅஅtotal_filesஅ=அlen(csv_dataframe)நஅஅஅஅtotal_secondsஅ=அ((csv_dataframe['wav_filesize']அ-அ)அ/அargs.sample_rateஅ/அargs.channelsஅ/அ(args.bits_per_sampleஅ//அ)).sum()நநஅஅஅஅprint('Totalஅbytes:',அtotal_bytes)நஅஅஅஅprint('Totalஅfiles:',அtotal_files)நஅஅஅஅprint('Totalஅtime:',அsecs_to_hours(total_seconds))நநifஅ__name__அ==அ'__main__':நஅஅஅஅmain()ந#!/usr/bin/envஅpythonந#அ-*-அcoding:அutf-அ-*-நfromஅ__future__அimportஅabsolute_import,அdivision,அprint_functionநநimportஅargparseநimportஅnumpyஅasஅnpநimportஅwaveநநfromஅdeepspeechஅimportஅModelநநநdefஅmain():நஅஅஅஅparserஅ=அargparse.ArgumentParser(description='RunningஅDeepSpeechஅinference.')நஅஅஅஅparser.add_argument('--model',அrequired=True,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Pathஅtoஅtheஅmodelஅ(protocolஅbufferஅbinaryஅfile)')நஅஅஅஅparser.add_argument('--scorer',அnargs='?',நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Pathஅtoஅtheஅexternalஅscorerஅfile')நஅஅஅஅparser.add_argument('--audio',அrequired=True,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Firstஅaudioஅfileஅtoஅuseஅinஅinterleavedஅstreams')நஅஅஅஅparser.add_argument('--audio',அrequired=True,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Secondஅaudioஅfileஅtoஅuseஅinஅinterleavedஅstreams')நஅஅஅஅargsஅ=அparser.parse_args()நநஅஅஅஅdsஅ=அModel(args.model)நநஅஅஅஅifஅargs.scorer:நஅஅஅஅஅஅஅஅds.enableExternalScorer(args.scorer)நநஅஅஅஅfinஅ=அwave.open(args.audio,அ'rb')நஅஅஅஅfsஅ=அfin.getframerate()நஅஅஅஅaudioஅ=அnp.frombuffer(fin.readframes(fin.getnframes()),அnp.int)நஅஅஅஅfin.close()நநஅஅஅஅfinஅ=அwave.open(args.audio,அ'rb')நஅஅஅஅfsஅ=அfin.getframerate()நஅஅஅஅaudioஅ=அnp.frombuffer(fin.readframes(fin.getnframes()),அnp.int)நஅஅஅஅfin.close()நநஅஅஅஅstreamஅ=அds.createStream()நஅஅஅஅstreamஅ=அds.createStream()நநஅஅஅஅsplitsஅ=அnp.array_split(audio,அ0)நஅஅஅஅsplitsஅ=அnp.array_split(audio,அ0)நநஅஅஅஅforஅpart,அpartஅinஅzip(splits,அsplits):நஅஅஅஅஅஅஅஅstream.feedAudioContent(part)நஅஅஅஅஅஅஅஅstream.feedAudioContent(part)நநஅஅஅஅprint(stream.finishStream())நஅஅஅஅprint(stream.finishStream())நநifஅ__name__அ==அ'__main__':நஅஅஅஅmain()ந#!/usr/bin/envஅpythonந#அ-*-அcoding:அutf-அ-*-நfromஅ__future__அimportஅabsolute_import,அdivision,அprint_functionநநimportஅargparseநimportஅnumpyஅasஅnpநimportஅshlexநimportஅsubprocessநimportஅsysநimportஅwaveநimportஅjsonநநfromஅdeepspeechஅimportஅModel,அversionநfromஅtimeitஅimportஅdefault_timerஅasஅtimerநநtry:நஅஅஅஅfromஅshhlexஅimportஅquoteநexceptஅImportError:நஅஅஅஅfromஅpipesஅimportஅquoteநநநdefஅconvert_samplerate(audio_path,அdesired_sample_rate):நஅஅஅஅsox_cmdஅ=அ'soxஅ{}அ--typeஅrawஅ--bitsஅஅ--channelsஅஅ--rateஅ{}அ--encodingஅsigned-integerஅ--endianஅlittleஅ--compressionஅ0.0அ--no-ditherஅ-அ'.format(quote(audio_path),அdesired_sample_rate)நஅஅஅஅtry:நஅஅஅஅஅஅஅஅoutputஅ=அsubprocess.check_output(shlex.split(sox_cmd),அstderr=subprocess.PIPE)நஅஅஅஅexceptஅsubprocess.CalledProcessErrorஅasஅe:நஅஅஅஅஅஅஅஅraiseஅRuntimeError('SoXஅreturnedஅnon-zeroஅstatus:அ{}'.format(e.stderr))நஅஅஅஅexceptஅOSErrorஅasஅe:நஅஅஅஅஅஅஅஅraiseஅOSError(e.errno,அ'SoXஅnotஅfound,அuseஅ{}hzஅfilesஅorஅinstallஅit:அ{}'.format(desired_sample_rate,அe.strerror))நநஅஅஅஅreturnஅdesired_sample_rate,அnp.frombuffer(output,அnp.int)நநநdefஅmetadata_to_string(metadata):நஅஅஅஅreturnஅ''.join(token.textஅforஅtokenஅinஅmetadata.tokens)நநநdefஅwords_from_candidate_transcript(metadata):நஅஅஅஅwordஅ=அ""நஅஅஅஅword_listஅ=அ[]நஅஅஅஅword_start_timeஅ=அ0நஅஅஅஅ#அLoopஅthroughஅeachஅcharacterநஅஅஅஅforஅi,அtokenஅinஅenumerate(metadata.tokens):நஅஅஅஅஅஅஅஅ#அAppendஅcharacterஅtoஅwordஅifஅit'sஅnotஅaஅspaceநஅஅஅஅஅஅஅஅifஅtoken.textஅ!=அ"அ":நஅஅஅஅஅஅஅஅஅஅஅஅifஅlen(word)அ==அ0:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ#அLogஅtheஅstartஅtimeஅofஅtheஅnewஅwordநஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅword_start_timeஅ=அtoken.start_timeநநஅஅஅஅஅஅஅஅஅஅஅஅwordஅ=அwordஅ+அtoken.textநஅஅஅஅஅஅஅஅ#அWordஅboundaryஅisஅeitherஅaஅspaceஅorஅtheஅlastஅcharacterஅinஅtheஅarrayநஅஅஅஅஅஅஅஅifஅtoken.textஅ==அ"அ"அorஅiஅ==அlen(metadata.tokens)அ-அ:நஅஅஅஅஅஅஅஅஅஅஅஅword_durationஅ=அtoken.start_timeஅ-அword_start_timeநநஅஅஅஅஅஅஅஅஅஅஅஅifஅword_durationஅ<அ0:நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅword_durationஅ=அ0நநஅஅஅஅஅஅஅஅஅஅஅஅeach_wordஅ=அdict()நஅஅஅஅஅஅஅஅஅஅஅஅeach_word["word"]அ=அwordநஅஅஅஅஅஅஅஅஅஅஅஅeach_word["start_time"]அ=அround(word_start_time,அ)நஅஅஅஅஅஅஅஅஅஅஅஅeach_word["duration"]அ=அround(word_duration,அ)நநஅஅஅஅஅஅஅஅஅஅஅஅword_list.append(each_word)நஅஅஅஅஅஅஅஅஅஅஅஅ#அResetநஅஅஅஅஅஅஅஅஅஅஅஅwordஅ=அ""நஅஅஅஅஅஅஅஅஅஅஅஅword_start_timeஅ=அ0நநஅஅஅஅreturnஅword_listநநநdefஅmetadata_json_output(metadata):நஅஅஅஅjson_resultஅ=அdict()நஅஅஅஅjson_result["transcripts"]அ=அ[{நஅஅஅஅஅஅஅஅ"confidence":அtranscript.confidence,நஅஅஅஅஅஅஅஅ"words":அwords_from_candidate_transcript(transcript),நஅஅஅஅ}அforஅtranscriptஅinஅmetadata.transcripts]நஅஅஅஅreturnஅjson.dumps(json_result,அindent=)நநநநclassஅVersionAction(argparse.Action):நஅஅஅஅdefஅ__init__(self,அ*args,அ**kwargs):நஅஅஅஅஅஅஅஅsuper(VersionAction,அself).__init__(nargs=0,அ*args,அ**kwargs)நநஅஅஅஅdefஅ__call__(self,அ*args,அ**kwargs):நஅஅஅஅஅஅஅஅprint('DeepSpeechஅ',அversion())நஅஅஅஅஅஅஅஅexit(0)நநநdefஅmain():நஅஅஅஅparserஅ=அargparse.ArgumentParser(description='RunningஅDeepSpeechஅinference.')நஅஅஅஅparser.add_argument('--model',அrequired=True,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Pathஅtoஅtheஅmodelஅ(protocolஅbufferஅbinaryஅfile)')நஅஅஅஅparser.add_argument('--scorer',அrequired=False,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Pathஅtoஅtheஅexternalஅscorerஅfile')நஅஅஅஅparser.add_argument('--audio',அrequired=True,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Pathஅtoஅtheஅaudioஅfileஅtoஅrunஅ(WAVஅformat)')நஅஅஅஅparser.add_argument('--beam_width',அtype=int,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='BeamஅwidthஅforஅtheஅCTCஅdecoder')நஅஅஅஅparser.add_argument('--lm_alpha',அtype=float,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Languageஅmodelஅweightஅ(lm_alpha).அIfஅnotஅspecified,அuseஅdefaultஅfromஅtheஅscorerஅpackage.')நஅஅஅஅparser.add_argument('--lm_beta',அtype=float,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Wordஅinsertionஅbonusஅ(lm_beta).அIfஅnotஅspecified,அuseஅdefaultஅfromஅtheஅscorerஅpackage.')நஅஅஅஅparser.add_argument('--version',அaction=VersionAction,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Printஅversionஅandஅexits')நஅஅஅஅparser.add_argument('--extended',அrequired=False,அaction='store_true',நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Outputஅstringஅfromஅextendedஅmetadata')நஅஅஅஅparser.add_argument('--json',அrequired=False,அaction='store_true',நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Outputஅjsonஅfromஅmetadataஅwithஅtimestampஅofஅeachஅword')நஅஅஅஅparser.add_argument('--candidate_transcripts',அtype=int,அdefault=,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='NumberஅofஅcandidateஅtranscriptsஅtoஅincludeஅinஅJSONஅoutput')நஅஅஅஅparser.add_argument('--hot_words',அtype=str,நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅhelp='Hot-wordsஅandஅtheirஅboosts.')நஅஅஅஅargsஅ=அparser.parse_args()நநஅஅஅஅprint('Loadingஅmodelஅfromஅfileஅ{}'.format(args.model),அfile=sys.stderr)நஅஅஅஅmodel_load_startஅ=அtimer()நஅஅஅஅ#அsphinx-doc:அpython_ref_model_startநஅஅஅஅdsஅ=அModel(args.model)நஅஅஅஅ#அsphinx-doc:அpython_ref_model_stopநஅஅஅஅmodel_load_endஅ=அtimer()அ-அmodel_load_startநஅஅஅஅprint('Loadedஅmodelஅinஅ{:.}s.'.format(model_load_end),அfile=sys.stderr)நநஅஅஅஅifஅargs.beam_width:நஅஅஅஅஅஅஅஅds.setBeamWidth(args.beam_width)நநஅஅஅஅdesired_sample_rateஅ=அds.sampleRate()நநஅஅஅஅifஅargs.scorer:நஅஅஅஅஅஅஅஅprint('Loadingஅscorerஅfromஅfilesஅ{}'.format(args.scorer),அfile=sys.stderr)நஅஅஅஅஅஅஅஅscorer_load_startஅ=அtimer()நஅஅஅஅஅஅஅஅds.enableExternalScorer(args.scorer)நஅஅஅஅஅஅஅஅscorer_load_endஅ=அtimer()அ-அscorer_load_startநஅஅஅஅஅஅஅஅprint('Loadedஅscorerஅinஅ{:.}s.'.format(scorer_load_end),அfile=sys.stderr)நநஅஅஅஅஅஅஅஅifஅargs.lm_alphaஅandஅargs.lm_beta:நஅஅஅஅஅஅஅஅஅஅஅஅds.setScorerAlphaBeta(args.lm_alpha,அargs.lm_beta)நநஅஅஅஅifஅargs.hot_words:நஅஅஅஅஅஅஅஅprint('Addingஅhot-words',அfile=sys.stderr)நஅஅஅஅஅஅஅஅforஅword_boostஅinஅargs.hot_words.split(','):நஅஅஅஅஅஅஅஅஅஅஅஅword,boostஅ=அword_boost.split(':')நஅஅஅஅஅஅஅஅஅஅஅஅds.addHotWord(word,float(boost))நநஅஅஅஅfinஅ=அwave.open(args.audio,அ'rb')நஅஅஅஅfs_origஅ=அfin.getframerate()நஅஅஅஅifஅfs_origஅ!=அdesired_sample_rate:நஅஅஅஅஅஅஅஅprint('Warning:அoriginalஅsampleஅrateஅ({})அisஅdifferentஅthanஅ{}hz.அResamplingஅmightஅproduceஅerraticஅspeechஅrecognition.'.format(fs_orig,அdesired_sample_rate),அfile=sys.stderr)நஅஅஅஅஅஅஅஅfs_new,அaudioஅ=அconvert_samplerate(args.audio,அdesired_sample_rate)நஅஅஅஅelse:நஅஅஅஅஅஅஅஅaudioஅ=அnp.frombuffer(fin.readframes(fin.getnframes()),அnp.int)நநஅஅஅஅaudio_lengthஅ=அfin.getnframes()அ*அ(/fs_orig)நஅஅஅஅfin.close()நநஅஅஅஅprint('Runningஅinference.',அfile=sys.stderr)நஅஅஅஅinference_startஅ=அtimer()நஅஅஅஅ#அsphinx-doc:அpython_ref_inference_startநஅஅஅஅifஅargs.extended:நஅஅஅஅஅஅஅஅprint(metadata_to_string(ds.sttWithMetadata(audio,அ).transcripts[0]))நஅஅஅஅelifஅargs.json:நஅஅஅஅஅஅஅஅprint(metadata_json_output(ds.sttWithMetadata(audio,அargs.candidate_transcripts)))நஅஅஅஅelse:நஅஅஅஅஅஅஅஅprint(ds.stt(audio))நஅஅஅஅ#அsphinx-doc:அpython_ref_inference_stopநஅஅஅஅinference_endஅ=அtimer()அ-அinference_startநஅஅஅஅprint('Inferenceஅtookஅ%0.fsஅforஅ%0.fsஅaudioஅfile.'அ%அ(inference_end,அaudio_length),அfile=sys.stderr)நநifஅ__name__அ==அ'__main__':நஅஅஅஅmain()நimportஅosநimportஅplatformநந#TheஅAPIஅisஅnotஅsnakeஅcaseஅwhichஅtriggersஅlinterஅerrorsந#pylint:அdisable=invalid-nameநநifஅplatform.system().lower()அ==அ"windows":நஅஅஅஅdslib_pathஅ=அos.path.join(os.path.dirname(os.path.realpath(__file__)),அ'lib')நநஅஅஅஅ#அOnஅWindows,அweஅcan'tஅrelyஅonஅRPATHஅbeingஅsetஅtoஅ$ORIGIN/lib/அorஅonநஅஅஅஅ#அ@loader_path/libநஅஅஅஅifஅhasattr(os,அ'add_dll_directory'):நஅஅஅஅஅஅஅஅ#அStartingஅwithஅPythonஅ.அthisஅproperlyஅhandlesஅtheஅproblemநஅஅஅஅஅஅஅஅos.add_dll_directory(dslib_path)நஅஅஅஅelse:நஅஅஅஅஅஅஅஅ#அBeforeஅPythinஅ.அweஅneedஅtoஅchangeஅtheஅPATHஅtoஅincludeஅtheஅproperநஅஅஅஅஅஅஅஅ#அdirectoryஅforஅtheஅdynamicஅlinkerநஅஅஅஅஅஅஅஅos.environ['PATH']அ=அdslib_pathஅ+அ';'அ+அos.environ['PATH']நநimportஅdeepspeechநந#அrenameஅforஅbackwardsஅcompatibilityநfromஅdeepspeech.implஅimportஅVersionஅasஅversionநநclassஅModel(object):நஅஅஅஅ"""நஅஅஅஅClassஅholdingஅaஅDeepSpeechஅmodelநநஅஅஅஅ:paramஅaModelPath:அPathஅtoஅmodelஅfileஅtoஅloadநஅஅஅஅ:typeஅaModelPath:அstrநஅஅஅஅ"""நஅஅஅஅdefஅ__init__(self,அmodel_path):நஅஅஅஅஅஅஅஅ#அmakeஅsureஅtheஅattributeஅisஅthereஅifஅCreateModelஅfailsநஅஅஅஅஅஅஅஅself._implஅ=அNoneநநஅஅஅஅஅஅஅஅstatus,அimplஅ=அdeepspeech.impl.CreateModel(model_path)நஅஅஅஅஅஅஅஅifஅstatusஅ!=அ0:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("CreateModelஅfailedஅwithஅ'{}'அ(0x{:X})".format(deepspeech.impl.ErrorCodeToErrorMessage(status),status))நஅஅஅஅஅஅஅஅself._implஅ=அimplநநஅஅஅஅdefஅ__del__(self):நஅஅஅஅஅஅஅஅifஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅdeepspeech.impl.FreeModel(self._impl)நஅஅஅஅஅஅஅஅஅஅஅஅself._implஅ=அNoneநநஅஅஅஅdefஅbeamWidth(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅGetஅbeamஅwidthஅvalueஅusedஅbyஅtheஅmodel.அIfஅsetModelBeamWidthஅwasஅnotநஅஅஅஅஅஅஅஅcalledஅbefore,அwillஅreturnஅtheஅdefaultஅvalueஅloadedஅfromஅtheஅmodelஅfile.நநஅஅஅஅஅஅஅஅ:return:அBeamஅwidthஅvalueஅusedஅbyஅtheஅmodel.நஅஅஅஅஅஅஅஅ:type:அintநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.GetModelBeamWidth(self._impl)நநஅஅஅஅdefஅsetBeamWidth(self,அbeam_width):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅSetஅbeamஅwidthஅvalueஅusedஅbyஅtheஅmodel.நநஅஅஅஅஅஅஅஅ:paramஅbeam_width:அTheஅbeamஅwidthஅusedஅbyஅtheஅmodel.அAஅlargerஅbeamஅwidthஅvalueஅgeneratesஅbetterஅresultsஅatஅtheஅcostஅofஅdecodingஅtime.நஅஅஅஅஅஅஅஅ:typeஅbeam_width:அintநநஅஅஅஅஅஅஅஅ:return:அZeroஅonஅsuccess,அnon-zeroஅonஅfailure.நஅஅஅஅஅஅஅஅ:type:அintநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.SetModelBeamWidth(self._impl,அbeam_width)நநஅஅஅஅdefஅsampleRate(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅReturnஅtheஅsampleஅrateஅexpectedஅbyஅtheஅmodel.நநஅஅஅஅஅஅஅஅ:return:அSampleஅrate.நஅஅஅஅஅஅஅஅ:type:அintநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.GetModelSampleRate(self._impl)நநஅஅஅஅdefஅenableExternalScorer(self,அscorer_path):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅEnableஅdecodingஅusingஅanஅexternalஅscorer.நநஅஅஅஅஅஅஅஅ:paramஅscorer_path:அTheஅpathஅtoஅtheஅexternalஅscorerஅfile.நஅஅஅஅஅஅஅஅ:typeஅscorer_path:அstrநநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅonஅerrorநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅstatusஅ=அdeepspeech.impl.EnableExternalScorer(self._impl,அscorer_path)நஅஅஅஅஅஅஅஅifஅstatusஅ!=அ0:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("EnableExternalScorerஅfailedஅwithஅ'{}'அ(0x{:X})".format(deepspeech.impl.ErrorCodeToErrorMessage(status),status))நநஅஅஅஅdefஅdisableExternalScorer(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅDisableஅdecodingஅusingஅanஅexternalஅscorer.நநஅஅஅஅஅஅஅஅ:return:அZeroஅonஅsuccess,அnon-zeroஅonஅfailure.நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.DisableExternalScorer(self._impl)நநஅஅஅஅdefஅaddHotWord(self,அword,அboost):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅAddஅaஅwordஅandஅitsஅboostஅforஅdecoding.நஅஅஅஅஅஅஅஅநஅஅஅஅஅஅஅஅWordsஅthatஅdon'tஅoccurஅinஅtheஅscorerஅ(e.g.அproperஅnouns)அorஅstringsஅthatஅcontainஅspacesஅwon'tஅbeஅtakenஅintoஅaccount.நநஅஅஅஅஅஅஅஅ:paramஅword:அtheஅhot-wordநஅஅஅஅஅஅஅஅ:typeஅword:அstrநநஅஅஅஅஅஅஅஅ:paramஅboost:அPositiveஅboostஅvalueஅincreasesஅandஅnegativeஅreducesஅchanceஅofஅaஅwordஅoccuringஅinஅaஅtranscription.அExcessiveஅpositiveஅboostஅmightஅleadஅtoஅsplittingஅupஅofஅlettersஅofஅtheஅwordஅfollowingஅtheஅhot-word.நஅஅஅஅஅஅஅஅ:typeஅboost:அfloatநநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅonஅerrorநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅstatusஅ=அdeepspeech.impl.AddHotWord(self._impl,அword,அboost)நஅஅஅஅஅஅஅஅifஅstatusஅ!=அ0:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("AddHotWordஅfailedஅwithஅ'{}'அ(0x{:X})".format(deepspeech.impl.ErrorCodeToErrorMessage(status),status))நநஅஅஅஅdefஅeraseHotWord(self,அword):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅRemoveஅentryஅforஅwordஅfromஅhot-wordsஅdict.நநஅஅஅஅஅஅஅஅ:paramஅword:அtheஅhot-wordநஅஅஅஅஅஅஅஅ:typeஅword:அstrநநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅonஅerrorநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅstatusஅ=அdeepspeech.impl.EraseHotWord(self._impl,அword)நஅஅஅஅஅஅஅஅifஅstatusஅ!=அ0:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("EraseHotWordஅfailedஅwithஅ'{}'அ(0x{:X})".format(deepspeech.impl.ErrorCodeToErrorMessage(status),status))நநஅஅஅஅdefஅclearHotWords(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅRemoveஅallஅentriesஅfromஅhot-wordsஅdict.நநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅonஅerrorநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅstatusஅ=அdeepspeech.impl.ClearHotWords(self._impl)நஅஅஅஅஅஅஅஅifஅstatusஅ!=அ0:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("ClearHotWordsஅfailedஅwithஅ'{}'அ(0x{:X})".format(deepspeech.impl.ErrorCodeToErrorMessage(status),status))நநஅஅஅஅdefஅsetScorerAlphaBeta(self,அalpha,அbeta):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅSetஅhyperparametersஅalphaஅandஅbetaஅofஅtheஅexternalஅscorer.நநஅஅஅஅஅஅஅஅ:paramஅalpha:அTheஅalphaஅhyperparameterஅofஅtheஅdecoder.அLanguageஅmodelஅweight.நஅஅஅஅஅஅஅஅ:typeஅalpha:அfloatநநஅஅஅஅஅஅஅஅ:paramஅbeta:அTheஅbetaஅhyperparameterஅofஅtheஅdecoder.அWordஅinsertionஅweight.நஅஅஅஅஅஅஅஅ:typeஅbeta:அfloatநநஅஅஅஅஅஅஅஅ:return:அZeroஅonஅsuccess,அnon-zeroஅonஅfailure.நஅஅஅஅஅஅஅஅ:type:அintநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.SetScorerAlphaBeta(self._impl,அalpha,அbeta)நநஅஅஅஅdefஅstt(self,அaudio_buffer):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅUseஅtheஅDeepSpeechஅmodelஅtoஅperformஅSpeech-To-Text.நநஅஅஅஅஅஅஅஅ:paramஅaudio_buffer:அAஅ-bit,அmonoஅrawஅaudioஅsignalஅatஅtheஅappropriateஅsampleஅrateஅ(matchingஅwhatஅtheஅmodelஅwasஅtrainedஅon).நஅஅஅஅஅஅஅஅ:typeஅaudio_buffer:அnumpy.intஅarrayநநஅஅஅஅஅஅஅஅ:return:அTheஅSTTஅresult.நஅஅஅஅஅஅஅஅ:type:அstrநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.SpeechToText(self._impl,அaudio_buffer)நநஅஅஅஅdefஅsttWithMetadata(self,அaudio_buffer,அnum_results=):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅUseஅtheஅDeepSpeechஅmodelஅtoஅperformஅSpeech-To-Textஅandஅreturnஅresultsஅincludingஅmetadata.நநஅஅஅஅஅஅஅஅ:paramஅaudio_buffer:அAஅ-bit,அmonoஅrawஅaudioஅsignalஅatஅtheஅappropriateஅsampleஅrateஅ(matchingஅwhatஅtheஅmodelஅwasஅtrainedஅon).நஅஅஅஅஅஅஅஅ:typeஅaudio_buffer:அnumpy.intஅarrayநநஅஅஅஅஅஅஅஅ:paramஅnum_results:அMaximumஅnumberஅofஅcandidateஅtranscriptsஅtoஅreturn.அReturnedஅlistஅmightஅbeஅsmallerஅthanஅthis.நஅஅஅஅஅஅஅஅ:typeஅnum_results:அintநநஅஅஅஅஅஅஅஅ:return:அMetadataஅobjectஅcontainingஅmultipleஅcandidateஅtranscripts.அEachஅtranscriptஅhasஅper-tokenஅmetadataஅincludingஅtimingஅinformation.நஅஅஅஅஅஅஅஅ:type:அ:func:`Metadata`நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.SpeechToTextWithMetadata(self._impl,அaudio_buffer,அnum_results)நநஅஅஅஅdefஅcreateStream(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅCreateஅaஅnewஅstreamingஅinferenceஅstate.அTheஅstreamingஅstateஅreturnedஅbyநஅஅஅஅஅஅஅஅthisஅfunctionஅcanஅthenஅbeஅpassedஅtoஅ:func:`feedAudioContent()`அandஅ:func:`finishStream()`.நநஅஅஅஅஅஅஅஅ:return:அStreamஅobjectஅrepresentingஅtheஅnewlyஅcreatedஅstreamநஅஅஅஅஅஅஅஅ:type:அ:func:`Stream`நநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅonஅerrorநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅstatus,அctxஅ=அdeepspeech.impl.CreateStream(self._impl)நஅஅஅஅஅஅஅஅifஅstatusஅ!=அ0:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("CreateStreamஅfailedஅwithஅ'{}'அ(0x{:X})".format(deepspeech.impl.ErrorCodeToErrorMessage(status),status))நஅஅஅஅஅஅஅஅreturnஅStream(ctx)நநநclassஅStream(object):நஅஅஅஅ"""நஅஅஅஅClassஅwrappingஅaஅDeepSpeechஅstream.அTheஅconstructorஅcannotஅbeஅcalledஅdirectly.நஅஅஅஅUseஅ:func:`Model.createStream()`நஅஅஅஅ"""நஅஅஅஅdefஅ__init__(self,அnative_stream):நஅஅஅஅஅஅஅஅself._implஅ=அnative_streamநநஅஅஅஅdefஅ__del__(self):நஅஅஅஅஅஅஅஅifஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅself.freeStream()நநஅஅஅஅdefஅfeedAudioContent(self,அaudio_buffer):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅFeedஅaudioஅsamplesஅtoஅanஅongoingஅstreamingஅinference.நநஅஅஅஅஅஅஅஅ:paramஅaudio_buffer:அAஅ-bit,அmonoஅrawஅaudioஅsignalஅatஅtheஅappropriateஅsampleஅrateஅ(matchingஅwhatஅtheஅmodelஅwasஅtrainedஅon).நஅஅஅஅஅஅஅஅ:typeஅaudio_buffer:அnumpy.intஅarrayநநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅifஅtheஅstreamஅobjectஅisஅnotஅvalidநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅifஅnotஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("Streamஅobjectஅisஅnotஅvalid.அTryingஅtoஅfeedஅanஅalreadyஅfinishedஅstream?")நஅஅஅஅஅஅஅஅdeepspeech.impl.FeedAudioContent(self._impl,அaudio_buffer)நநஅஅஅஅdefஅintermediateDecode(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅComputeஅtheஅintermediateஅdecodingஅofஅanஅongoingஅstreamingஅinference.நநஅஅஅஅஅஅஅஅ:return:அTheஅSTTஅintermediateஅresult.நஅஅஅஅஅஅஅஅ:type:அstrநநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅifஅtheஅstreamஅobjectஅisஅnotஅvalidநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅifஅnotஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("Streamஅobjectஅisஅnotஅvalid.அTryingஅtoஅdecodeஅanஅalreadyஅfinishedஅstream?")நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.IntermediateDecode(self._impl)நநஅஅஅஅdefஅintermediateDecodeWithMetadata(self,அnum_results=):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅComputeஅtheஅintermediateஅdecodingஅofஅanஅongoingஅstreamingஅinferenceஅandஅreturnஅresultsஅincludingஅmetadata.நநஅஅஅஅஅஅஅஅ:paramஅnum_results:அMaximumஅnumberஅofஅcandidateஅtranscriptsஅtoஅreturn.அReturnedஅlistஅmightஅbeஅsmallerஅthanஅthis.நஅஅஅஅஅஅஅஅ:typeஅnum_results:அintநநஅஅஅஅஅஅஅஅ:return:அMetadataஅobjectஅcontainingஅmultipleஅcandidateஅtranscripts.அEachஅtranscriptஅhasஅper-tokenஅmetadataஅincludingஅtimingஅinformation.நஅஅஅஅஅஅஅஅ:type:அ:func:`Metadata`நநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅifஅtheஅstreamஅobjectஅisஅnotஅvalidநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅifஅnotஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("Streamஅobjectஅisஅnotஅvalid.அTryingஅtoஅdecodeஅanஅalreadyஅfinishedஅstream?")நஅஅஅஅஅஅஅஅreturnஅdeepspeech.impl.IntermediateDecodeWithMetadata(self._impl,அnum_results)நநஅஅஅஅdefஅfinishStream(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅComputeஅtheஅfinalஅdecodingஅofஅanஅongoingஅstreamingஅinferenceஅandஅreturnநஅஅஅஅஅஅஅஅtheஅresult.அSignalsஅtheஅendஅofஅanஅongoingஅstreamingஅinference.அTheஅunderlyingநஅஅஅஅஅஅஅஅstreamஅobjectஅmustஅnotஅbeஅusedஅafterஅthisஅmethodஅisஅcalled.நநஅஅஅஅஅஅஅஅ:return:அTheஅSTTஅresult.நஅஅஅஅஅஅஅஅ:type:அstrநநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅifஅtheஅstreamஅobjectஅisஅnotஅvalidநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅifஅnotஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("Streamஅobjectஅisஅnotஅvalid.அTryingஅtoஅfinishஅanஅalreadyஅfinishedஅstream?")நஅஅஅஅஅஅஅஅresultஅ=அdeepspeech.impl.FinishStream(self._impl)நஅஅஅஅஅஅஅஅself._implஅ=அNoneநஅஅஅஅஅஅஅஅreturnஅresultநநஅஅஅஅdefஅfinishStreamWithMetadata(self,அnum_results=):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅComputeஅtheஅfinalஅdecodingஅofஅanஅongoingஅstreamingஅinferenceஅandஅreturnநஅஅஅஅஅஅஅஅresultsஅincludingஅmetadata.அSignalsஅtheஅendஅofஅanஅongoingஅstreamingநஅஅஅஅஅஅஅஅinference.அTheஅunderlyingஅstreamஅobjectஅmustஅnotஅbeஅusedஅafterஅthisநஅஅஅஅஅஅஅஅmethodஅisஅcalled.நநஅஅஅஅஅஅஅஅ:paramஅnum_results:அMaximumஅnumberஅofஅcandidateஅtranscriptsஅtoஅreturn.அReturnedஅlistஅmightஅbeஅsmallerஅthanஅthis.நஅஅஅஅஅஅஅஅ:typeஅnum_results:அintநநஅஅஅஅஅஅஅஅ:return:அMetadataஅobjectஅcontainingஅmultipleஅcandidateஅtranscripts.அEachஅtranscriptஅhasஅper-tokenஅmetadataஅincludingஅtimingஅinformation.நஅஅஅஅஅஅஅஅ:type:அ:func:`Metadata`நநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅifஅtheஅstreamஅobjectஅisஅnotஅvalidநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅifஅnotஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("Streamஅobjectஅisஅnotஅvalid.அTryingஅtoஅfinishஅanஅalreadyஅfinishedஅstream?")நஅஅஅஅஅஅஅஅresultஅ=அdeepspeech.impl.FinishStreamWithMetadata(self._impl,அnum_results)நஅஅஅஅஅஅஅஅself._implஅ=அNoneநஅஅஅஅஅஅஅஅreturnஅresultநநஅஅஅஅdefஅfreeStream(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅDestroyஅaஅstreamingஅstateஅwithoutஅdecodingஅtheஅcomputedஅlogits.அThisஅcanநஅஅஅஅஅஅஅஅbeஅusedஅifஅyouஅnoஅlongerஅneedஅtheஅresultஅofஅanஅongoingஅstreamingஅinference.நநஅஅஅஅஅஅஅஅ:throws:அRuntimeErrorஅifஅtheஅstreamஅobjectஅisஅnotஅvalidநஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅifஅnotஅself._impl:நஅஅஅஅஅஅஅஅஅஅஅஅraiseஅRuntimeError("Streamஅobjectஅisஅnotஅvalid.அTryingஅtoஅfreeஅanஅalreadyஅfinishedஅstream?")நஅஅஅஅஅஅஅஅdeepspeech.impl.FreeStream(self._impl)நஅஅஅஅஅஅஅஅself._implஅ=அNoneநநந#அThisஅisஅonlyஅforஅdocumentationஅpurposeந#அMetadata,அCandidateTranscriptஅandஅTokenMetadataஅshouldஅbeஅinஅsyncஅwithஅnative_client/deepspeech.hநclassஅTokenMetadata(object):நஅஅஅஅ"""நஅஅஅஅStoresஅeachஅindividualஅcharacter,அalongஅwithஅitsஅtimingஅinformationநஅஅஅஅ"""நநஅஅஅஅdefஅtext(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅTheஅtextஅforஅthisஅtokenநஅஅஅஅஅஅஅஅ"""நநநஅஅஅஅdefஅtimestep(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅPositionஅofஅtheஅtokenஅinஅunitsஅofஅ0msநஅஅஅஅஅஅஅஅ"""நநநஅஅஅஅdefஅstart_time(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅPositionஅofஅtheஅtokenஅinஅsecondsநஅஅஅஅஅஅஅஅ"""நநநclassஅCandidateTranscript(object):நஅஅஅஅ"""நஅஅஅஅStoresஅtheஅentireஅCTCஅoutputஅasஅanஅarrayஅofஅcharacterஅmetadataஅobjectsநஅஅஅஅ"""நஅஅஅஅdefஅtokens(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅListஅofஅtokensநநஅஅஅஅஅஅஅஅ:return:அAஅlistஅofஅ:func:`TokenMetadata`அelementsநஅஅஅஅஅஅஅஅ:type:அlistநஅஅஅஅஅஅஅஅ"""நநநஅஅஅஅdefஅconfidence(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅApproximatedஅconfidenceஅvalueஅforஅthisஅtranscription.அThisஅisஅroughlyஅtheநஅஅஅஅஅஅஅஅsumஅofஅtheஅacousticஅmodelஅlogitஅvaluesஅforஅeachஅtimestep/characterஅthatநஅஅஅஅஅஅஅஅcontributedஅtoஅtheஅcreationஅofஅthisஅtranscription.நஅஅஅஅஅஅஅஅ"""நநநclassஅMetadata(object):நஅஅஅஅdefஅtranscripts(self):நஅஅஅஅஅஅஅஅ"""நஅஅஅஅஅஅஅஅListஅofஅcandidateஅtranscriptsநநஅஅஅஅஅஅஅஅ:return:அAஅlistஅofஅ:func:`CandidateTranscript`அobjectsநஅஅஅஅஅஅஅஅ:type:அlistநஅஅஅஅஅஅஅஅ"""ந#!அ/usr/bin/envஅpythonநநfromஅsetuptoolsஅimportஅsetup,அExtensionநfromஅdistutils.command.buildஅimportஅbuildநநimportஅosநimportஅsubprocessநimportஅsysநநdefஅmain():நஅஅஅஅtry:நஅஅஅஅஅஅஅஅimportஅnumpyநஅஅஅஅஅஅஅஅtry:நஅஅஅஅஅஅஅஅஅஅஅஅnumpy_includeஅ=அnumpy.get_include()நஅஅஅஅஅஅஅஅexceptஅAttributeError:நஅஅஅஅஅஅஅஅஅஅஅஅnumpy_includeஅ=அnumpy.get_numpy_include()நஅஅஅஅexceptஅImportError:நஅஅஅஅஅஅஅஅnumpy_includeஅ=அ''நஅஅஅஅஅஅஅஅassertஅ'NUMPY_INCLUDE'அinஅos.environநநஅஅஅஅdefஅread(fname):நஅஅஅஅஅஅஅஅreturnஅopen(os.path.join(os.path.dirname(__file__),அfname)).read()நநஅஅஅஅnumpy_includeஅ=அos.getenv('NUMPY_INCLUDE',அnumpy_include)நஅஅஅஅnumpy_min_verஅ=அos.getenv('NUMPY_DEP_VERSION',அ'')நநஅஅஅஅproject_nameஅ=அ'deepspeech'நஅஅஅஅifஅ'--project_name'அinஅsys.argv:நஅஅஅஅஅஅஅஅproject_name_idxஅ=அsys.argv.index('--project_name')நஅஅஅஅஅஅஅஅproject_nameஅ=அsys.argv[project_name_idxஅ+அ]நஅஅஅஅஅஅஅஅsys.argv.remove('--project_name')நஅஅஅஅஅஅஅஅsys.argv.pop(project_name_idx)நநஅஅஅஅwithஅopen('../../training/deepspeech_training/VERSION',அ'r')அasஅver:நஅஅஅஅஅஅஅஅproject_versionஅ=அver.read().strip()நநஅஅஅஅclassஅBuildExtFirst(build):நஅஅஅஅஅஅஅஅsub_commandsஅ=அ[('build_ext',அbuild.has_ext_modules),நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ('build_py',அbuild.has_pure_modules),நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ('build_clib',அbuild.has_c_libraries),நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅ('build_scripts',அbuild.has_scripts)]நநஅஅஅஅ#அProperlyஅpassஅargumentsஅforஅlinking,அsetuptoolsஅwillஅperformஅsomeஅchecksநஅஅஅஅdefஅlib_dirs_split(a):நஅஅஅஅஅஅஅஅifஅos.nameஅ==அ'posix':நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅa.split('-L')[:]நநஅஅஅஅஅஅஅஅifஅos.nameஅ==அ'nt':நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅ[]நநஅஅஅஅஅஅஅஅraiseஅAssertionError('os.nameஅ==அjavaஅnotஅexpected')நநஅஅஅஅdefஅlibs_split(a):நஅஅஅஅஅஅஅஅifஅos.nameஅ==அ'posix':நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅa.split('-l')[:]நநஅஅஅஅஅஅஅஅifஅos.nameஅ==அ'nt':நஅஅஅஅஅஅஅஅஅஅஅஅreturnஅa.split('.lib')[0:]நநஅஅஅஅஅஅஅஅraiseஅAssertionError('os.nameஅ==அjavaஅnotஅexpected')நநஅஅஅஅds_extஅ=அExtension(name='deepspeech._impl',நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅsources=['impl.i'],நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅinclude_dirs=[numpy_include,அ'../'],நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅlibrary_dirs=list(map(lambdaஅx:அx.strip(),அlib_dirs_split(os.getenv('MODEL_LDFLAGS',அ'')))),நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅlibraries=list(map(lambdaஅx:அx.strip(),அlibs_split(os.getenv('MODEL_LIBS',அ'')))),நஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅஅswig_opts=['-c++',அ'-keyword'])நநஅஅஅஅsetup(name=project_name,நஅஅஅஅஅஅஅஅஅஅdescription='AஅlibraryஅforஅrunningஅinferenceஅonஅaஅDeepSpeechஅmodel',நஅஅஅஅஅஅஅஅஅஅlong_description=read('README.rst'),நஅஅஅஅஅஅஅஅஅஅlong_description_content_type='text/x-rst;அcharset=UTF-',நஅஅஅஅஅஅஅஅஅஅauthor='Mozilla',நஅஅஅஅஅஅஅஅஅஅversion=project_version,நஅஅஅஅஅஅஅஅஅஅpackage_dir={'deepspeech':அ'.'},நஅஅஅஅஅஅஅஅஅஅcmdclass={'build':அBuildExtFirst},நஅஅஅஅஅஅஅஅஅஅlicense='MPL-.0',நஅஅஅஅஅஅஅஅஅஅurl='https://github.com/mozilla/DeepSpeech',நஅஅஅஅஅஅஅஅஅஅproject_urls={ந